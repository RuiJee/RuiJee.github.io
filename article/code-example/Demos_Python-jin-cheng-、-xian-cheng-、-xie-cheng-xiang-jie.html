<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Python进程、线程、协程详解</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Alex">

    <!-- Le styles -->
    <link rel="stylesheet" href="/theme/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="/theme/css/nest.css" type="text/css" />
    <link rel="stylesheet" href="/theme/css/fonts.css" type="text/css" />
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
      .tag-1 {
        font-size: 13pt;
      }
      .tag-2 {
        font-size: 10pt;
      }
      .tag-2 {
        font-size: 8pt;
      }
      .tag-4 {
        font-size: 6pt;
     }
    </style>
    <link href="/theme/css/bootstrap-responsive.min.css" rel="stylesheet">
        <link href="/theme/css/font-awesome.css" rel="stylesheet">

    <link href="/theme/css/pygments.css" rel="stylesheet">

    <!--<link href="/theme/css/base.css" rel="stylesheet">-->

    <script src="/theme/js/jquery-1.7.2.min.js"></script>



    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/theme/images/favicon.ico">
    <link rel="apple-touch-icon" href="/theme/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/theme/images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/theme/images/apple-touch-icon-114x114.png">

    <link href="/" type="application/atom+xml" rel="alternate" title="Alex's Blog ATOM Feed" />

  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/index.html">Alex's Blog </a>
          <div class="nav-collapse">
            <ul class="nav">
                          <li class="divider-vertical"></li>
                  <li class="active">
                    <a href="/category/code-example/index.html">
						<i class="icon-folder-open icon-large"></i>Code Example
					</a>
                  </li>
                  <li >
                    <a href="/category/linux/index.html">
						<i class="icon-folder-open icon-large"></i>Linux
					</a>
                  </li>
                  <li >
                    <a href="/category/pa-chong-ji-zhu/index.html">
						<i class="icon-folder-open icon-large"></i>爬虫技术
					</a>
                  </li>
                  <li >
                    <a href="/category/pythonji-zhu/index.html">
						<i class="icon-folder-open icon-large"></i>Python技术
					</a>
                  </li>
                              <!--<li ><a href="/categories.html"><i class="icon-folder-close icon-large"></i>Categories</a></li>-->
                                <li><a href="/tags.html"><i class="icon-tags icon-large"></i>Tags</a></li>
                          <ul class="nav pull-right">

                                <li><a href="/archives.html"><i class="icon-th-list"></i>文章列表</a></li>
                          </ul>

            </ul>
            <!--<p class="navbar-text pull-right">Logged in as <a href="#">username</a></p>-->
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="row">
        <div class="span9" id="content">
<section id="content">
        <article>
                <header>
                        <h1>
                                <a href=""
                                        rel="bookmark"
                                        title="Permalink to Python进程、线程、协程详解">
                                        Python进程、线程、协程详解
                                </a>
                        </h1>
                </header>
                <div class="entry-content">
                <div class="well">
<footer class="post-info">
<span class="label">Date</span>
<abbr class="published" title="2018-01-01T00:00:00+08:00">
        <i class="icon-calendar"></i>Mon 01 January 2018
</abbr>
<span class="label">By</span>
<a href="/author/alex/"><i class="icon-user"></i>Alex</a>
<span class="label">Category</span>
<a href="/category/code-example/index.html"><i class="icon-folder-open"></i>Code Example</a>.


<span class="label">Tags</span>
	<a href="/tag/code_demos/index.html"><i class="icon-tag"></i>code_Demos</a>

</footer><!-- /.post-info -->                </div>
                <div class="highlight"><pre><span></span><span class="c1"># Python进程、线程、协程详解</span>

<span class="c1">### 进程与线程的历史</span>

<span class="err">我们都知道计算机是由硬件和软件组成的。硬件中的</span><span class="n">CPU</span><span class="err">是计算机的核心，它承担计算机的所有任务。</span>
<span class="err">操作系统是运行在硬件之上的软件，是计算机的管理者，它负责资源的管理和分配、任务的调度。</span> <span class="err">程序是运行在系统上的具有某种功能的软件，比如说浏览器，音乐播放器等。</span>
<span class="err">每次执行程序的时候，都会完成一定的功能，比如说浏览器帮我们打开网页，为了保证其独立性，就需要一个专门的管理和控制执行程序的数据结构——进程控制块。</span>
<span class="err">进程就是一个程序在一个数据集上的一次动态执行过程。</span> <span class="err">进程一般由程序、数据集、进程控制块三部分组成。我们编写的程序用来描述进程要完成哪些功能以及如何完成；数据</span>
<span class="err">集则是程序在执行过程中所需要使用的资源；进程控制块用来记录进程的外部特征，描述进程的执行变化过程，系统可以利用它来控制和管理进程，它是系统感知进程存在的唯一</span>
<span class="err">标志。</span>



<span class="err">在早期的操作系统里，计算机只有一个核心，进程执行程序的最小单位，任务调度采用时间片轮转的抢占式方式进行进程调度。每个进程都有各自的一块独立的内存，保证进程彼</span>
<span class="err">此间的内存地址空间的隔离。</span> <span class="err">随着计算机技术的发展，进程出现了很多弊端，一是进程的创建、撤销和切换的开销比较大，二是由于对称多处理机（对称多处理机</span>
<span class="err">（</span><span class="n">SymmetricalMulti</span><span class="o">-</span><span class="n">Processing</span><span class="err">）又叫</span><span class="n">SMP</span><span class="err">，是指在一个计算机上汇集了一组处理器</span><span class="p">(</span><span class="err">多</span><span class="n">CPU</span><span class="p">)</span><span class="err">，各</span><span class="n">CPU</span><span class="err">之间共享内存子系统以及总线结构</span>
<span class="err">）的出现，可以满足多个运行单位，而多进程并行开销过大。</span> <span class="err">这个时候就引入了线程的概念。</span>
<span class="err">线程也叫轻量级进程，它是一个基本的</span><span class="n">CPU</span><span class="err">执行单元，也是程序执行过程中的最小单元，由线程</span><span class="n">ID</span><span class="err">、程序计数器、寄存器集合</span>
<span class="err">和堆栈共同组成。线程的引入减小了程序并发执行时的开销，提高了操作系统的并发性能。</span>
<span class="err">线程没有自己的系统资源，只拥有在运行时必不可少的资源。但线程可以与同属与同一进程的其他线程共享进程所拥有的其他资源。</span>



<span class="c1">### 进程与线程之间的关系</span>

<span class="err">线程是属于进程的，线程运行在进程空间内，同一进程所产生的线程共享同一内存空间，当进程退出时该进程所产生的线程都会被强制退出并清除。线程可与属于同一进程的其它</span>
<span class="err">线程共享进程所拥有的全部资源，但是其本身基本上不拥有系统资源，只拥有一点在运行中必不可少的信息</span><span class="p">(</span><span class="err">如程序计数器、一组寄存器和栈</span><span class="p">)</span><span class="err">。</span>



<span class="n">python</span> <span class="err">线程</span>

<span class="n">Threading</span><span class="err">用于提供线程相关的操作，线程是应用程序中工作的最小单元。</span>



<span class="c1">### 1、threading模块</span>

<span class="n">threading</span> <span class="err">模块建立在</span> <span class="n">_thread</span> <span class="err">模块之上。</span><span class="n">thread</span> <span class="err">模块以低级、原始的方式来处理和控制线程，而</span> <span class="n">threading</span> <span class="err">模块通过对</span>
<span class="n">thread</span> <span class="err">进行二次封装，提供了更方便的</span> <span class="n">api</span> <span class="err">来处理线程。</span>



    <span class="n">import</span><span class="err"> </span><span class="n">threading</span>
    <span class="n">import</span><span class="err"> </span><span class="n">time</span>
    <span class="err">  </span>
    <span class="n">def</span><span class="err"> </span><span class="n">worker</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="err">    </span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        thread worker function</span>
<span class="s2">        :return:</span>
<span class="s2">        &quot;&quot;&quot;</span>
    <span class="err">    </span><span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="err">    </span><span class="k">print</span><span class="p">(</span><span class="s2">&quot;The num is  </span><span class="si">%d</span><span class="s2">&quot;</span><span class="err"> </span><span class="o">%</span><span class="err"> </span><span class="n">num</span><span class="p">)</span>
    <span class="err">    </span><span class="k">return</span>
    <span class="err">  </span>
    <span class="k">for</span><span class="err"> </span><span class="n">i</span><span class="err"> </span><span class="ow">in</span><span class="err"> </span><span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="err">    </span><span class="n">t</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">worker</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,)</span><span class="err">，</span><span class="n">name</span><span class="o">=</span><span class="err">“</span><span class="n">t</span><span class="o">.%</span><span class="n">d</span><span class="err">” </span><span class="o">%</span><span class="err"> </span><span class="n">i</span><span class="p">)</span>
    <span class="err">    </span><span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="err">上述代码创建了</span><span class="mi">20</span><span class="err">个“前台”线程，然后控制器就交给了</span><span class="n">CPU</span><span class="err">，</span><span class="n">CPU</span><span class="err">根据指定算法进行调度，分片执行指令。</span>



<span class="n">Thread</span><span class="err">方法说明</span>



<span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="p">:</span> <span class="err">激活线程，</span>



<span class="n">t</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="p">:</span> <span class="err">获取线程的名称</span>



<span class="n">t</span><span class="o">.</span><span class="n">setName</span><span class="p">()</span> <span class="err">：</span> <span class="err">设置线程的名称</span>



<span class="n">t</span><span class="o">.</span><span class="n">name</span> <span class="p">:</span> <span class="err">获取或设置线程的名称</span>



<span class="n">t</span><span class="o">.</span><span class="n">is_alive</span><span class="p">()</span> <span class="err">：</span> <span class="err">判断线程是否为激活状态</span>



<span class="n">t</span><span class="o">.</span><span class="n">isAlive</span><span class="p">()</span> <span class="err">：判断线程是否为激活状态</span>



<span class="n">t</span><span class="o">.</span><span class="n">setDaemon</span><span class="p">()</span> <span class="err">设置为后台线程或前台线程（默认：</span><span class="bp">False</span><span class="err">）</span><span class="p">;</span><span class="err">通过一个布尔值设置线程是否为守护线程，必须在执行</span><span class="n">start</span><span class="p">()</span><span class="err">方法之后才可以使用。</span>
<span class="err">如果是后台线程，主线程执行过程中，后台线程也在进行，主线程执行完毕后，后台线程不论成功与否，均停止；如果是前台线程，主线程执行过程中，前台线程也在进行，主线</span>
<span class="err">程执行完毕后，等待前台线程也执行完成后，程序停止</span>



<span class="n">t</span><span class="o">.</span><span class="n">isDaemon</span><span class="p">()</span> <span class="err">：</span> <span class="err">判断是否为守护线程</span>



<span class="n">t</span><span class="o">.</span><span class="n">ident</span> <span class="err">：获取线程的标识符。线程标识符是一个非零整数，只有在调用了</span><span class="n">start</span><span class="p">()</span><span class="err">方法之后该属性才有效，否则它只返回</span><span class="bp">None</span><span class="err">。</span>



<span class="n">t</span><span class="o">.</span><span class="n">join</span><span class="p">()</span> <span class="err">：逐个执行每个线程，执行完毕后继续往下执行，该方法使得多线程变得无意义</span>



<span class="n">t</span><span class="o">.</span><span class="n">run</span><span class="p">()</span> <span class="err">：线程被</span><span class="n">cpu</span><span class="err">调度后自动执行线程对象的</span><span class="n">run</span><span class="err">方法</span>



<span class="c1">### 2、线程锁threading.RLock和threading.Lock</span>



<span class="err">由于线程之间是进行随机调度，并且每个线程可能只执行</span><span class="n">n</span><span class="err">条执行之后，</span><span class="n">CPU</span><span class="err">接着执行其他线程。为了保证数据的准确性，引入了锁的概念。所以，可能出现如下问题：</span>



<span class="err">例：假设列表</span><span class="n">A</span><span class="err">的所有元素就为</span><span class="mi">0</span><span class="err">，当一个线程从前向后打印列表的所有元素，另外一个线程则从后向前修改列表的元素为</span><span class="mi">1</span><span class="p">,</span><span class="err">那么输出的时候，列表的元素就会一部分为</span><span class="mi">0</span><span class="err">，一</span>
<span class="err">部分为</span><span class="mi">1</span><span class="p">,</span><span class="err">这就导致了数据的不一致。锁的出现解决了这个问题。</span>



    <span class="n">import</span><span class="err"> </span><span class="n">threading</span>
    <span class="n">import</span><span class="err"> </span><span class="n">time</span>
    <span class="err">  </span>
    <span class="n">globals_num</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="mi">0</span>
    <span class="err">  </span>
    <span class="n">lock</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">threading</span><span class="o">.</span><span class="n">RLock</span><span class="p">()</span>
    <span class="err">  </span>
    <span class="n">def</span><span class="err"> </span><span class="n">Func</span><span class="p">():</span>
    <span class="err">    </span><span class="n">lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span><span class="err">  </span><span class="c1"># 获得锁</span>
    <span class="err">    </span><span class="k">global</span><span class="err"> </span><span class="n">globals_num</span>
    <span class="err">    </span><span class="n">globals_num</span><span class="err"> </span><span class="o">+=</span><span class="err"> </span><span class="mi">1</span>
    <span class="err">    </span><span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="err">    </span><span class="k">print</span><span class="p">(</span><span class="n">globals_num</span><span class="p">)</span>
    <span class="err">    </span><span class="n">lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span><span class="err">  </span><span class="c1"># 释放锁</span>
    <span class="err">  </span>
    <span class="k">for</span><span class="err"> </span><span class="n">i</span><span class="err"> </span><span class="ow">in</span><span class="err"> </span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="err">    </span><span class="n">t</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">Func</span><span class="p">)</span>
    <span class="err">    </span><span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>



<span class="c1">### 3、threading.RLock和threading.Lock 的区别</span>

<span class="n">RLock</span><span class="err">允许在同一线程中被多次</span><span class="n">acquire</span><span class="err">。而</span><span class="n">Lock</span><span class="err">却不允许这种情况。</span>
<span class="err">如果使用</span><span class="n">RLock</span><span class="err">，那么</span><span class="n">acquire</span><span class="err">和</span><span class="n">release</span><span class="err">必须成对出现，即调用了</span><span class="n">n</span><span class="err">次</span><span class="n">acquire</span><span class="err">，必须调用</span><span class="n">n</span><span class="err">次的</span><span class="n">release</span><span class="err">才能真正释放所占用的琐。</span>



    <span class="n">import</span><span class="err"> </span><span class="n">threading</span>
    <span class="n">lock</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span><span class="err">    </span><span class="c1">#Lock对象</span>
    <span class="n">lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
    <span class="n">lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span><span class="err">  </span><span class="c1">#产生了死琐。</span>
    <span class="n">lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
    <span class="n">lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span><span class="err">　</span>
    <span class="n">import</span><span class="err"> </span><span class="n">threading</span>
    <span class="n">rLock</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">threading</span><span class="o">.</span><span class="n">RLock</span><span class="p">()</span><span class="err">  </span><span class="c1">#RLock对象</span>
    <span class="n">rLock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
    <span class="n">rLock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span><span class="err">    </span><span class="c1">#在同一线程内，程序不会堵塞。</span>
    <span class="n">rLock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
    <span class="n">rLock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>



<span class="c1">### 4、threading.Event</span>



<span class="n">python</span><span class="err">线程的事件用于主线程控制其他线程的执行，事件主要提供了三个方法</span> <span class="nb">set</span><span class="err">、</span><span class="n">wait</span><span class="err">、</span><span class="n">clear</span><span class="err">。</span>



<span class="err">事件处理的机制：全局定义了一个“</span><span class="n">Flag</span><span class="err">”，如果“</span><span class="n">Flag</span><span class="err">”值为</span> <span class="bp">False</span><span class="err">，那么当程序执行</span> <span class="n">event</span><span class="o">.</span><span class="n">wait</span>
<span class="err">方法时就会阻塞，如果“</span><span class="n">Flag</span><span class="err">”值为</span><span class="bp">True</span><span class="err">，那么</span><span class="n">event</span><span class="o">.</span><span class="n">wait</span> <span class="err">方法时便不再阻塞。</span>



<span class="n">clear</span><span class="err">：将“</span><span class="n">Flag</span><span class="err">”设置为</span><span class="bp">False</span>

<span class="nb">set</span><span class="err">：将“</span><span class="n">Flag</span><span class="err">”设置为</span><span class="bp">True</span>

<span class="n">Event</span><span class="o">.</span><span class="n">isSet</span><span class="p">()</span> <span class="err">：判断标识位是否为</span><span class="n">Ture</span><span class="err">。</span>



    <span class="n">import</span><span class="err"> </span><span class="n">threading</span>
    <span class="err">  </span>
    <span class="n">def</span><span class="err"> </span><span class="n">do</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="err">    </span><span class="k">print</span><span class="p">(</span><span class="s1">&#39;start&#39;</span><span class="p">)</span>
    <span class="err">    </span><span class="n">event</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
    <span class="err">    </span><span class="k">print</span><span class="p">(</span><span class="s1">&#39;execute&#39;</span><span class="p">)</span>
    <span class="err">  </span>
    <span class="n">event_obj</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
    <span class="k">for</span><span class="err"> </span><span class="n">i</span><span class="err"> </span><span class="ow">in</span><span class="err"> </span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="err">    </span><span class="n">t</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">do</span><span class="p">,</span><span class="err"> </span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">event_obj</span><span class="p">,))</span>
    <span class="err">    </span><span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="err">  </span>
    <span class="n">event_obj</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="n">inp</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="nb">input</span><span class="p">(</span><span class="s1">&#39;input:&#39;</span><span class="p">)</span>
    <span class="k">if</span><span class="err"> </span><span class="n">inp</span><span class="err"> </span><span class="o">==</span><span class="err"> </span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
    <span class="err">    </span><span class="n">event_obj</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

<span class="err">当线程执行的时候，如果</span><span class="n">flag</span><span class="err">为</span><span class="bp">False</span><span class="err">，则线程会阻塞，当</span><span class="n">flag</span><span class="err">为</span><span class="bp">True</span><span class="err">的时候，线程不会阻塞。它提供了本地和远程的并发性。</span>



<span class="c1">### 5、threading.Condition</span>



<span class="err">一个</span><span class="n">condition</span><span class="err">变量总是与某些类型的锁相联系，这个可以使用默认的情况或创建一个，当几个</span><span class="n">condition</span><span class="err">变量必须共享和同一个锁的时候，是很有用的。锁是</span>
<span class="n">conditon</span><span class="err">对象的一部分：没有必要分别跟踪。</span>



<span class="n">condition</span><span class="err">变量服从上下文管理协议：</span><span class="k">with</span><span class="err">语句块封闭之前可以获取与锁的联系。</span> <span class="n">acquire</span><span class="p">()</span> <span class="err">和</span> <span class="n">release</span><span class="p">()</span>
<span class="err">会调用与锁相关联的相应的方法。</span>



<span class="err">其他和锁关联的方法必须被调用，</span><span class="n">wait</span><span class="p">()</span><span class="err">方法会释放锁，当另外一个线程使用</span> <span class="n">notify</span><span class="p">()</span> <span class="ow">or</span>
<span class="n">notify_all</span><span class="p">()</span><span class="err">唤醒它之前会一直阻塞。一旦被唤醒，</span><span class="n">wait</span><span class="p">()</span><span class="err">会重新获得锁并返回，</span>



<span class="n">Condition</span><span class="err">类实现了一个</span><span class="n">conditon</span><span class="err">变量。</span> <span class="err">这个</span><span class="n">conditiaon</span><span class="err">变量允许一个或多个线程等待，直到他们被另一个线程通知。</span>
<span class="err">如果</span><span class="n">lock</span><span class="err">参数，被给定一个非空的值，，那么他必须是一个</span><span class="n">lock</span><span class="err">或者</span><span class="n">Rlock</span><span class="err">对象，它用来做底层锁。否则，会创建一个新的</span><span class="n">Rlock</span><span class="err">对象，用来做底层锁。</span>



<span class="n">wait</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span> <span class="err">：</span>
<span class="err">等待通知，或者等到设定的超时时间。当调用这</span><span class="n">wait</span><span class="p">()</span><span class="err">方法时，如果调用它的线程没有得到锁，那么会抛出一个</span><span class="ne">RuntimeError</span> <span class="err">异常。</span>
<span class="n">wati</span><span class="p">()</span><span class="err">释放锁以后，在被调用相同条件的另一个进程用</span><span class="n">notify</span><span class="p">()</span> <span class="ow">or</span> <span class="n">notify_all</span><span class="p">()</span> <span class="err">叫醒之前</span> <span class="err">会一直阻塞。</span><span class="n">wait</span><span class="p">()</span>
<span class="err">还可以指定一个超时时间。</span>

<span class="err">如果有等待的线程，</span><span class="n">notify</span><span class="p">()</span><span class="err">方法会唤醒一个在等待</span><span class="n">conditon</span><span class="err">变量的线程。</span><span class="n">notify_all</span><span class="p">()</span> <span class="err">则会唤醒所有在等待</span><span class="n">conditon</span><span class="err">变量的线程。</span>



<span class="err">注意：</span> <span class="n">notify</span><span class="p">()</span><span class="err">和</span><span class="n">notify_all</span><span class="p">()</span><span class="err">不会释放锁，也就是说，线程被唤醒后不会立刻返回他们的</span><span class="n">wait</span><span class="p">()</span>
<span class="err">调用。除非线程调用</span><span class="n">notify</span><span class="p">()</span><span class="err">和</span><span class="n">notify_all</span><span class="p">()</span><span class="err">之后放弃了锁的所有权。</span>



<span class="err">在典型的设计风格里，利用</span><span class="n">condition</span><span class="err">变量用锁去通许访问一些共享状态，线程在获取到它想得到的状态前，会反复调用</span><span class="n">wait</span><span class="p">()</span><span class="err">。修改状态的线程在他们状态改变</span>
<span class="err">时调用</span> <span class="n">notify</span><span class="p">()</span> <span class="ow">or</span> <span class="n">notify_all</span><span class="p">()</span><span class="err">，用这种方式，线程会尽可能的获取到想要的一个等待者状态。</span> <span class="err">例子：</span> <span class="err">生产者</span><span class="o">-</span><span class="err">消费者模型，</span>



    <span class="n">import</span><span class="err"> </span><span class="n">threading</span>
    <span class="n">import</span><span class="err"> </span><span class="n">time</span>
    <span class="n">def</span><span class="err"> </span><span class="n">consumer</span><span class="p">(</span><span class="n">cond</span><span class="p">):</span>
    <span class="err">    </span><span class="k">with</span><span class="err"> </span><span class="n">cond</span><span class="p">:</span>
    <span class="err">        </span><span class="k">print</span><span class="p">(</span><span class="s2">&quot;consumer before wait&quot;</span><span class="p">)</span>
    <span class="err">        </span><span class="n">cond</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
    <span class="err">        </span><span class="k">print</span><span class="p">(</span><span class="s2">&quot;consumer after wait&quot;</span><span class="p">)</span>
    <span class="err">  </span>
    <span class="n">def</span><span class="err"> </span><span class="n">producer</span><span class="p">(</span><span class="n">cond</span><span class="p">):</span>
    <span class="err">    </span><span class="k">with</span><span class="err"> </span><span class="n">cond</span><span class="p">:</span>
    <span class="err">        </span><span class="k">print</span><span class="p">(</span><span class="s2">&quot;producer before notifyAll&quot;</span><span class="p">)</span>
    <span class="err">        </span><span class="n">cond</span><span class="o">.</span><span class="n">notifyAll</span><span class="p">()</span>
    <span class="err">        </span><span class="k">print</span><span class="p">(</span><span class="s2">&quot;producer after notifyAll&quot;</span><span class="p">)</span>
    <span class="err">  </span>
    <span class="n">condition</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">threading</span><span class="o">.</span><span class="n">Condition</span><span class="p">()</span>
    <span class="n">c1</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;c1&quot;</span><span class="p">,</span><span class="err"> </span><span class="n">target</span><span class="o">=</span><span class="n">consumer</span><span class="p">,</span><span class="err"> </span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">condition</span><span class="p">,))</span>
    <span class="n">c2</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;c2&quot;</span><span class="p">,</span><span class="err"> </span><span class="n">target</span><span class="o">=</span><span class="n">consumer</span><span class="p">,</span><span class="err"> </span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">condition</span><span class="p">,))</span>
    <span class="err">  </span>
    <span class="n">p</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;p&quot;</span><span class="p">,</span><span class="err"> </span><span class="n">target</span><span class="o">=</span><span class="n">producer</span><span class="p">,</span><span class="err"> </span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">condition</span><span class="p">,))</span>
    <span class="err">  </span>
    <span class="n">c1</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">c2</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>



<span class="c1">### 6、queue模块</span>



<span class="n">Queue</span> <span class="err">就是对队列，它是线程安全的</span>



<span class="err">举例来说，我们去麦当劳吃饭。饭店里面有厨师职位，前台负责把厨房做好的饭卖给顾客，顾客则去前台领取做好的饭。这里的前台就相当于我们的队列。形成管道样，厨师做好</span>
<span class="err">饭通过前台传送给顾客，所谓单向队列</span>



<span class="err">这个模型也叫生产者</span><span class="o">-</span><span class="err">消费者模型。</span>



    <span class="n">import</span><span class="err"> </span><span class="n">queue</span>
    <span class="err"> </span>
    <span class="n">q</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">queue</span><span class="o">.</span><span class="n">Queue</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="err">  </span><span class="c1"># 构造一个先进显出队列，maxsize指定队列长度，为0 时，表示队列长度无限制。</span>
    <span class="err"> </span>
    <span class="n">q</span><span class="o">.</span><span class="n">join</span><span class="p">()</span><span class="err">    </span><span class="c1"># 等到队列为kong的时候，在执行别的操作</span>
    <span class="n">q</span><span class="o">.</span><span class="n">qsize</span><span class="p">()</span><span class="err">   </span><span class="c1"># 返回队列的大小 （不可靠）</span>
    <span class="n">q</span><span class="o">.</span><span class="n">empty</span><span class="p">()</span><span class="err">   </span><span class="c1"># 当队列为空的时候，返回True 否则返回False （不可靠）</span>
    <span class="n">q</span><span class="o">.</span><span class="n">full</span><span class="p">()</span><span class="err">    </span><span class="c1"># 当队列满的时候，返回True，否则返回False （不可靠）</span>
    <span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="err"> </span><span class="n">block</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="err"> </span><span class="n">timeout</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span><span class="err"> </span><span class="c1">#  将item放入Queue尾部，item必须存在，可以参数block默认为True,表示当队列满时，会等待队列给出可用位置，</span>
    <span class="err">　　　　　　　　　　　　　　　　　　　　　　　　 为</span><span class="bp">False</span><span class="err">时为非阻塞，此时如果队列已满，会引发</span><span class="n">queue</span><span class="o">.</span><span class="n">Full</span><span class="err"> 异常。 可选参数</span><span class="n">timeout</span><span class="err">，表示 会阻塞设置的时间，过后，</span>
    <span class="err">　　　　　　　　　　　　　　　　　　　　　　　　  如果队列无法给出放入</span><span class="n">item</span><span class="err">的位置，则引发 </span><span class="n">queue</span><span class="o">.</span><span class="n">Full</span><span class="err"> 异常</span>
    <span class="n">q</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="err"> </span><span class="n">timeout</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span><span class="err"> </span><span class="c1">#   移除并返回队列头部的一个值，可选参数block默认为True，表示获取值的时候，如果队列为空，则阻塞，为False时，不阻塞，</span>
    <span class="err">　　　　　　　　　　　　　　　　　　　　　　若此时队列为空，则引发 </span><span class="n">queue</span><span class="o">.</span><span class="n">Empty</span><span class="err">异常。 可选参数</span><span class="n">timeout</span><span class="err">，表示会阻塞设置的时候，过后，如果队列为空，则引发</span><span class="n">Empty</span><span class="err">异常。</span>
    <span class="n">q</span><span class="o">.</span><span class="n">put_nowait</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="err"> </span><span class="c1">#   等效于 put(item,block=False)</span>
    <span class="n">q</span><span class="o">.</span><span class="n">get_nowait</span><span class="p">()</span><span class="err"> </span><span class="c1">#    等效于 get(item,block=False)</span>

<span class="err">代码如下：</span>



    <span class="c1">#!/usr/bin/env python</span>
    <span class="n">import</span><span class="err"> </span><span class="n">Queue</span>
    <span class="n">import</span><span class="err"> </span><span class="n">threading</span>
    <span class="n">message</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">Queue</span><span class="o">.</span><span class="n">Queue</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="err"> </span>
    <span class="err"> </span>
    <span class="n">def</span><span class="err"> </span><span class="n">producer</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="err">    </span><span class="k">while</span><span class="err"> </span><span class="bp">True</span><span class="p">:</span>
    <span class="err">        </span><span class="n">message</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="err"> </span>
    <span class="err"> </span>
    <span class="n">def</span><span class="err"> </span><span class="n">consumer</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="err">    </span><span class="k">while</span><span class="err"> </span><span class="bp">True</span><span class="p">:</span>
    <span class="err">        </span><span class="n">msg</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">message</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
    <span class="err"> </span>
    <span class="err"> </span>
    <span class="k">for</span><span class="err"> </span><span class="n">i</span><span class="err"> </span><span class="ow">in</span><span class="err"> </span><span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="p">):</span>
    <span class="err">    </span><span class="n">t</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">producer</span><span class="p">,</span><span class="err"> </span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,))</span>
    <span class="err">    </span><span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="err"> </span>
    <span class="k">for</span><span class="err"> </span><span class="n">i</span><span class="err"> </span><span class="ow">in</span><span class="err"> </span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="err">    </span><span class="n">t</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">consumer</span><span class="p">,</span><span class="err"> </span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,))</span>
    <span class="err">    </span><span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="err">那就自己做个线程池吧：</span>



    <span class="c1"># 简单往队列中传输线程数</span>
    <span class="n">import</span><span class="err"> </span><span class="n">threading</span>
    <span class="n">import</span><span class="err"> </span><span class="n">time</span>
    <span class="n">import</span><span class="err"> </span><span class="n">queue</span>
    <span class="n">class</span><span class="err"> </span><span class="n">Threadingpool</span><span class="p">():</span>
    <span class="err">    </span><span class="n">def</span><span class="err"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">max_num</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="mi">10</span><span class="p">):</span>
    <span class="err">        </span><span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">queue</span><span class="o">.</span><span class="n">Queue</span><span class="p">(</span><span class="n">max_num</span><span class="p">)</span>
    <span class="err">        </span><span class="k">for</span><span class="err"> </span><span class="n">i</span><span class="err"> </span><span class="ow">in</span><span class="err"> </span><span class="nb">range</span><span class="p">(</span><span class="n">max_num</span><span class="p">):</span>
    <span class="err">            </span><span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">)</span>
    <span class="err">    </span><span class="n">def</span><span class="err"> </span><span class="n">getthreading</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="err">        </span><span class="k">return</span><span class="err"> </span><span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
    <span class="err">    </span><span class="n">def</span><span class="err"> </span><span class="n">addthreading</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="err">        </span><span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">)</span>
    <span class="n">def</span><span class="err"> </span><span class="n">func</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>
    <span class="err">    </span><span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="err">    </span><span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="err">    </span><span class="n">p</span><span class="o">.</span><span class="n">addthreading</span><span class="p">()</span>
    <span class="k">if</span><span class="err"> </span><span class="vm">__name__</span><span class="err"> </span><span class="o">==</span><span class="err"> </span><span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="err">    </span><span class="n">p</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">Threadingpool</span><span class="p">()</span>
    <span class="err">    </span><span class="k">for</span><span class="err"> </span><span class="n">i</span><span class="err"> </span><span class="ow">in</span><span class="err"> </span><span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="err">        </span><span class="n">thread</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">p</span><span class="o">.</span><span class="n">getthreading</span><span class="p">()</span>
    <span class="err">        </span><span class="n">t</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">thread</span><span class="p">(</span><span class="n">target</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">func</span><span class="p">,</span><span class="err"> </span><span class="n">args</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">i</span><span class="p">))</span>
    <span class="err">        </span><span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>





    <span class="c1">#往队列中无限添加任务</span>
    <span class="n">import</span><span class="err"> </span><span class="n">queue</span>
    <span class="n">import</span><span class="err"> </span><span class="n">threading</span>
    <span class="n">import</span><span class="err"> </span><span class="n">contextlib</span>
    <span class="n">import</span><span class="err"> </span><span class="n">time</span>
    <span class="n">StopEvent</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="nb">object</span><span class="p">()</span>
    <span class="n">class</span><span class="err"> </span><span class="n">ThreadPool</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="err">    </span><span class="n">def</span><span class="err"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="err"> </span><span class="n">max_num</span><span class="p">):</span>
    <span class="err">        </span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">queue</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
    <span class="err">        </span><span class="bp">self</span><span class="o">.</span><span class="n">max_num</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">max_num</span>
    <span class="err">        </span><span class="bp">self</span><span class="o">.</span><span class="n">terminal</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="bp">False</span>
    <span class="err">        </span><span class="bp">self</span><span class="o">.</span><span class="n">generate_list</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="p">[]</span>
    <span class="err">        </span><span class="bp">self</span><span class="o">.</span><span class="n">free_list</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="p">[]</span>
    <span class="err">    </span><span class="n">def</span><span class="err"> </span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="err"> </span><span class="n">func</span><span class="p">,</span><span class="err"> </span><span class="n">args</span><span class="p">,</span><span class="err"> </span><span class="n">callback</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="err">        </span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            线程池执行一个任务</span>
<span class="s2">            :param func: 任务函数</span>
<span class="s2">            :param args: 任务函数所需参数</span>
<span class="s2">            :param callback: 任务执行失败或成功后执行的回调函数，回调函数有两个参数1、任务函数执行状态；2、任务函数返回值（默认为None，即：不执行回调函数）</span>
<span class="s2">            :return: 如果线程池已经终止，则返回True否则None</span>
<span class="s2">            &quot;&quot;&quot;</span>
    <span class="err">        </span><span class="k">if</span><span class="err"> </span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">free_list</span><span class="p">)</span><span class="err"> </span><span class="o">==</span><span class="err"> </span><span class="mi">0</span><span class="err"> </span><span class="ow">and</span><span class="err"> </span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generate_list</span><span class="p">)</span><span class="err"> </span><span class="o">&lt;</span><span class="err"> </span><span class="bp">self</span><span class="o">.</span><span class="n">max_num</span><span class="p">:</span>
    <span class="err">            </span><span class="bp">self</span><span class="o">.</span><span class="n">generate_thread</span><span class="p">()</span>
    <span class="err">        </span><span class="n">w</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="p">(</span><span class="n">func</span><span class="p">,</span><span class="err"> </span><span class="n">args</span><span class="p">,</span><span class="err"> </span><span class="n">callback</span><span class="p">,)</span>
    <span class="err">        </span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
    <span class="err">    </span><span class="n">def</span><span class="err"> </span><span class="n">generate_thread</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="err">        </span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            创建一个线程</span>
<span class="s2">            &quot;&quot;&quot;</span>
    <span class="err">        </span><span class="n">t</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">)</span>
    <span class="err">        </span><span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="err">    </span><span class="n">def</span><span class="err"> </span><span class="n">call</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="err">        </span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            循环去获取任务函数并执行任务函数</span>
<span class="s2">            &quot;&quot;&quot;</span>
    <span class="err">        </span><span class="n">current_thread</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">threading</span><span class="o">.</span><span class="n">currentThread</span>
    <span class="err">        </span><span class="bp">self</span><span class="o">.</span><span class="n">generate_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_thread</span><span class="p">)</span>
    <span class="err">        </span><span class="n">event</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="err">  </span><span class="c1"># 获取线程</span>
    <span class="err">        </span><span class="k">while</span><span class="err"> </span><span class="n">event</span><span class="err"> </span><span class="o">!=</span><span class="err"> </span><span class="n">StopEvent</span><span class="p">:</span><span class="err">   </span><span class="c1"># 判断获取的线程数不等于全局变量</span>
    <span class="err">            </span><span class="n">func</span><span class="p">,</span><span class="err"> </span><span class="n">arguments</span><span class="p">,</span><span class="err"> </span><span class="n">callback</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">event</span><span class="err">   </span><span class="c1"># 拆分元祖，获得执行函数，参数，回调函数</span>
    <span class="err">            </span><span class="k">try</span><span class="p">:</span>
    <span class="err">                </span><span class="n">result</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">arguments</span><span class="p">)</span><span class="err">   </span><span class="c1"># 执行函数</span>
    <span class="err">                </span><span class="n">status</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="bp">True</span>
    <span class="err">            </span><span class="k">except</span><span class="err"> </span><span class="ne">Exception</span><span class="err"> </span><span class="k">as</span><span class="err"> </span><span class="n">e</span><span class="p">:</span><span class="err">    </span><span class="c1"># 函数执行失败</span>
    <span class="err">                </span><span class="n">status</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="bp">False</span>
    <span class="err">                </span><span class="n">result</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">e</span>
    <span class="err">            </span><span class="k">if</span><span class="err"> </span><span class="n">callback</span><span class="err"> </span><span class="ow">is</span><span class="err"> </span><span class="ow">not</span><span class="err"> </span><span class="bp">None</span><span class="p">:</span>
    <span class="err">                </span><span class="k">try</span><span class="p">:</span>
    <span class="err">                    </span><span class="n">callback</span><span class="p">(</span><span class="n">status</span><span class="p">,</span><span class="err"> </span><span class="n">result</span><span class="p">)</span>
    <span class="err">                </span><span class="k">except</span><span class="err"> </span><span class="ne">Exception</span><span class="err"> </span><span class="k">as</span><span class="err"> </span><span class="n">e</span><span class="p">:</span>
    <span class="err">                    </span><span class="k">pass</span>
    <span class="err">            </span><span class="c1"># self.free_list.append(current_thread)</span>
    <span class="err">            </span><span class="c1"># event = self.q.get()</span>
    <span class="err">            </span><span class="c1"># self.free_list.remove(current_thread)</span>
    <span class="err">            </span><span class="k">with</span><span class="err"> </span><span class="bp">self</span><span class="o">.</span><span class="n">work_state</span><span class="p">():</span>
    <span class="err">                </span><span class="n">event</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
    <span class="err">        </span><span class="k">else</span><span class="p">:</span>
    <span class="err">            </span><span class="bp">self</span><span class="o">.</span><span class="n">generate_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">current_thread</span><span class="p">)</span>
    <span class="err">    </span><span class="n">def</span><span class="err"> </span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="err">        </span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            关闭线程，给传输全局非元祖的变量来进行关闭</span>
<span class="s2">            :return:</span>
<span class="s2">            &quot;&quot;&quot;</span>
    <span class="err">        </span><span class="k">for</span><span class="err"> </span><span class="n">i</span><span class="err"> </span><span class="ow">in</span><span class="err"> </span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generate_list</span><span class="p">)):</span>
    <span class="err">            </span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">StopEvent</span><span class="p">)</span>
    <span class="err">    </span><span class="n">def</span><span class="err"> </span><span class="n">terminate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="err">        </span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            突然关闭线程</span>
<span class="s2">            :return:</span>
<span class="s2">            &quot;&quot;&quot;</span>
    <span class="err">        </span><span class="bp">self</span><span class="o">.</span><span class="n">terminal</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="bp">True</span>
    <span class="err">        </span><span class="k">while</span><span class="err"> </span><span class="bp">self</span><span class="o">.</span><span class="n">generate_list</span><span class="p">:</span>
    <span class="err">            </span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">StopEvent</span><span class="p">)</span>
    <span class="err">        </span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="o">.</span><span class="n">empty</span><span class="p">()</span>
    <span class="err">    </span><span class="nd">@contextlib.contextmanager</span>
    <span class="err">    </span><span class="n">def</span><span class="err"> </span><span class="n">work_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="err">        </span><span class="bp">self</span><span class="o">.</span><span class="n">free_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">currentThread</span><span class="p">)</span>
    <span class="err">        </span><span class="k">try</span><span class="p">:</span>
    <span class="err">            </span><span class="k">yield</span>
    <span class="err">        </span><span class="k">finally</span><span class="p">:</span>
    <span class="err">            </span><span class="bp">self</span><span class="o">.</span><span class="n">free_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">currentThread</span><span class="p">)</span>
    <span class="n">def</span><span class="err"> </span><span class="n">work</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="err">    </span><span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="err">    </span><span class="k">return</span><span class="err"> </span><span class="n">i</span><span class="err"> </span><span class="o">+</span><span class="mi">1</span><span class="err"> </span><span class="c1"># 返回给回调函数</span>
    <span class="n">def</span><span class="err"> </span><span class="n">callback</span><span class="p">(</span><span class="n">ret</span><span class="p">):</span>
    <span class="err">    </span><span class="k">print</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
    <span class="n">pool</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">ThreadPool</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="k">for</span><span class="err"> </span><span class="n">item</span><span class="err"> </span><span class="ow">in</span><span class="err"> </span><span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">):</span>
    <span class="err">    </span><span class="n">pool</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">work</span><span class="p">,</span><span class="err"> </span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">item</span><span class="p">,),</span><span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">)</span>
    <span class="n">pool</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
    <span class="c1"># pool.close()</span>



<span class="c1">### python 进程</span>

<span class="n">multiprocessing</span><span class="err">是</span><span class="n">python</span><span class="err">的多进程管理包，和</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="err">类似。</span>



<span class="c1">### 1、multiprocessing模块</span>



<span class="err">直接从侧面用</span><span class="n">subprocesses</span><span class="err">替换线程使用</span><span class="n">GIL</span><span class="err">的方式，由于这一点，</span><span class="n">multiprocessing</span><span class="err">模块可以让程序员在给定的机器上充分的利用</span><span class="n">CPU</span><span class="err">。在</span><span class="n">m</span>
<span class="n">ultiprocessing</span><span class="err">中，通过创建</span><span class="n">Process</span><span class="err">对象生成进程，然后调用它的</span><span class="n">start</span><span class="p">()</span><span class="err">方法，</span>



    <span class="n">from</span><span class="err"> </span><span class="n">multiprocessing</span><span class="err"> </span><span class="n">import</span><span class="err"> </span><span class="n">Process</span>
    <span class="err"> </span>
    <span class="n">def</span><span class="err"> </span><span class="n">func</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="err">    </span><span class="k">print</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">,</span><span class="err"> </span><span class="n">name</span><span class="p">)</span>
    <span class="err"> </span>
    <span class="err"> </span>
    <span class="k">if</span><span class="err"> </span><span class="vm">__name__</span><span class="err"> </span><span class="o">==</span><span class="err"> </span><span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="err">    </span><span class="n">p</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">func</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;zhangyanlin&#39;</span><span class="p">,))</span>
    <span class="err">    </span><span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="err">    </span><span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span><span class="err">  </span><span class="c1"># 等待进程执行完毕</span>

<span class="err">在使用并发设计的时候最好尽可能的避免共享数据，尤其是在使用多进程的时候。</span> <span class="err">如果你真有需要</span> <span class="err">要共享数据，</span> <span class="n">multiprocessing</span><span class="err">提供了两种方式。</span>



<span class="err">（</span><span class="mi">1</span><span class="err">）</span><span class="n">multiprocessing</span><span class="err">，</span><span class="n">Array</span><span class="p">,</span><span class="n">Value</span>



<span class="err">数据可以用</span><span class="n">Value</span><span class="err">或</span><span class="n">Array</span><span class="err">存储在一个共享内存地图里，如下：</span>



    <span class="n">from</span><span class="err"> </span><span class="n">multiprocessing</span><span class="err"> </span><span class="n">import</span><span class="err"> </span><span class="n">Array</span><span class="p">,</span><span class="n">Value</span><span class="p">,</span><span class="n">Process</span>
    <span class="err"> </span>
    <span class="n">def</span><span class="err"> </span><span class="n">func</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
    <span class="err">    </span><span class="n">a</span><span class="o">.</span><span class="n">value</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="mf">3.333333333333333</span>
    <span class="err">    </span><span class="k">for</span><span class="err"> </span><span class="n">i</span><span class="err"> </span><span class="ow">in</span><span class="err"> </span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)):</span>
    <span class="err">        </span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="o">-</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="err"> </span>
    <span class="err"> </span>
    <span class="k">if</span><span class="err"> </span><span class="vm">__name__</span><span class="err"> </span><span class="o">==</span><span class="err"> </span><span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="err">    </span><span class="n">num</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">Value</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="err">    </span><span class="n">arr</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">Array</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span><span class="mi">11</span><span class="p">))</span>
    <span class="err"> </span>
    <span class="err"> </span>
    <span class="err">    </span><span class="n">c</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">func</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">num</span><span class="p">,</span><span class="n">arr</span><span class="p">))</span>
    <span class="err">    </span><span class="n">d</span><span class="o">=</span><span class="err"> </span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">func</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">num</span><span class="p">,</span><span class="n">arr</span><span class="p">))</span>
    <span class="err">    </span><span class="n">c</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="err">    </span><span class="n">d</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="err">    </span><span class="n">c</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
    <span class="err">    </span><span class="n">d</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
    <span class="err"> </span>
    <span class="err">    </span><span class="k">print</span><span class="p">(</span><span class="n">num</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="err">    </span><span class="k">for</span><span class="err"> </span><span class="n">i</span><span class="err"> </span><span class="ow">in</span><span class="err"> </span><span class="n">arr</span><span class="p">:</span>
    <span class="err">        </span><span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

<span class="err">输出：</span>



    <span class="err">　　</span><span class="mf">3.1415927</span>
    <span class="err">　　</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="err"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="err"> </span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="err"> </span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="err"> </span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="err"> </span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="err"> </span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="err"> </span><span class="o">-</span><span class="mi">7</span><span class="p">,</span><span class="err"> </span><span class="o">-</span><span class="mi">8</span><span class="p">,</span><span class="err"> </span><span class="o">-</span><span class="mi">9</span><span class="p">]</span>

<span class="err">创建</span><span class="n">num</span><span class="err">和</span><span class="n">arr</span><span class="err">时，“</span><span class="n">d</span><span class="err">”和“</span><span class="n">i</span><span class="err">”参数由</span><span class="n">Array</span><span class="err">模块使用的</span><span class="n">typecodes</span><span class="err">创建：“</span><span class="n">d</span><span class="err">”表示一个双精度的浮点数，“</span><span class="n">i</span><span class="err">”表示一个有符号的整数，这些共享对象</span>
<span class="err">将被线程安全的处理。</span>



<span class="n">Array</span><span class="p">(</span><span class="err">‘</span><span class="n">i</span><span class="err">’</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span><span class="err">中的‘</span><span class="n">i</span><span class="err">’参数：</span>



<span class="err">‘</span><span class="n">c</span><span class="err">’</span><span class="p">:</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char</span><span class="err">　　　　</span> <span class="err">‘</span><span class="n">u</span><span class="err">’</span><span class="p">:</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_wchar</span><span class="err">　　　　‘</span><span class="n">b</span><span class="err">’</span><span class="p">:</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_byte</span><span class="err">　　　　</span> <span class="err">‘</span><span class="n">B</span><span class="err">’</span><span class="p">:</span>
<span class="n">ctypes</span><span class="o">.</span><span class="n">c_ubyte</span>

<span class="err">‘</span><span class="n">h</span><span class="err">’</span><span class="p">:</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_short</span><span class="err">　　　</span> <span class="err"> ‘</span><span class="n">H</span><span class="err">’</span><span class="p">:</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_ushort</span><span class="err">　　</span> <span class="err"> ‘</span><span class="n">i</span><span class="err">’</span><span class="p">:</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="err">　　　　　</span> <span class="err">‘</span><span class="n">I</span><span class="err">’</span><span class="p">:</span>
<span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint</span>

<span class="err">‘</span><span class="n">l</span><span class="err">’</span><span class="p">:</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_long</span><span class="p">,</span><span class="err">　　　　‘</span><span class="n">L</span><span class="err">’</span><span class="p">:</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_ulong</span><span class="err">　　　　‘</span><span class="n">f</span><span class="err">’</span><span class="p">:</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span><span class="err">　　　　‘</span><span class="n">d</span><span class="err">’</span><span class="p">:</span>
<span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span>



<span class="err">（</span><span class="mi">2</span><span class="err">）</span><span class="n">multiprocessing</span><span class="err">，</span><span class="n">Manager</span>



<span class="err">由</span><span class="n">Manager</span><span class="p">()</span><span class="err">返回的</span><span class="n">manager</span><span class="err">提供</span><span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">Namespace</span><span class="p">,</span> <span class="n">Lock</span><span class="p">,</span> <span class="n">RLock</span><span class="p">,</span> <span class="n">Semaphore</span><span class="p">,</span>
<span class="n">BoundedSemaphore</span><span class="p">,</span> <span class="n">Condition</span><span class="p">,</span> <span class="n">Event</span><span class="p">,</span> <span class="n">Barrier</span><span class="p">,</span> <span class="n">Queue</span><span class="p">,</span> <span class="n">Value</span> <span class="ow">and</span> <span class="n">Array</span><span class="err">类型的支持。</span>



    <span class="n">from</span><span class="err"> </span><span class="n">multiprocessing</span><span class="err"> </span><span class="n">import</span><span class="err"> </span><span class="n">Process</span><span class="p">,</span><span class="n">Manager</span>
    <span class="n">def</span><span class="err"> </span><span class="n">f</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">l</span><span class="p">):</span>
    <span class="err">    </span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="s2">&quot;zhangyanlin&quot;</span>
    <span class="err">    </span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="mi">18</span>
    <span class="err">    </span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;Job&quot;</span><span class="p">]</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="s2">&quot;pythoner&quot;</span>
    <span class="err">    </span><span class="n">l</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="err"> </span>
    <span class="k">if</span><span class="err"> </span><span class="vm">__name__</span><span class="err"> </span><span class="o">==</span><span class="err"> </span><span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="err">    </span><span class="k">with</span><span class="err"> </span><span class="n">Manager</span><span class="p">()</span><span class="err"> </span><span class="k">as</span><span class="err"> </span><span class="n">man</span><span class="p">:</span>
    <span class="err">        </span><span class="n">d</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">man</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span>
    <span class="err">        </span><span class="n">l</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">man</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
    <span class="err"> </span>
    <span class="err">        </span><span class="n">p</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">f</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">l</span><span class="p">))</span>
    <span class="err">        </span><span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="err">        </span><span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
    <span class="err"> </span>
    <span class="err">        </span><span class="k">print</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="err">        </span><span class="k">print</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>



<span class="err">输出：</span>




    <span class="err">　　</span><span class="p">{</span><span class="mf">0.25</span><span class="p">:</span><span class="err"> </span><span class="bp">None</span><span class="p">,</span><span class="err"> </span><span class="mi">1</span><span class="p">:</span><span class="err"> </span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="err"> </span><span class="s1">&#39;2&#39;</span><span class="p">:</span><span class="err"> </span><span class="mi">2</span><span class="p">}</span>
    <span class="err">　　</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="err"> </span><span class="mi">8</span><span class="p">,</span><span class="err"> </span><span class="mi">7</span><span class="p">,</span><span class="err"> </span><span class="mi">6</span><span class="p">,</span><span class="err"> </span><span class="mi">5</span><span class="p">,</span><span class="err"> </span><span class="mi">4</span><span class="p">,</span><span class="err"> </span><span class="mi">3</span><span class="p">,</span><span class="err"> </span><span class="mi">2</span><span class="p">,</span><span class="err"> </span><span class="mi">1</span><span class="p">,</span><span class="err"> </span><span class="mi">0</span><span class="p">]</span>

<span class="n">Server</span> <span class="n">process</span> <span class="n">manager</span><span class="err">比</span> <span class="n">shared</span> <span class="n">memory</span>
<span class="err">更灵活，因为它可以支持任意的对象类型。另外，一个单独的</span><span class="n">manager</span><span class="err">可以通过进程在网络上不同的计算机之间共享，不过他比</span><span class="n">shared</span> <span class="n">memory</span><span class="err">要慢。</span>



<span class="c1">### 2、进程池（Using a pool of workers）</span>



<span class="n">Pool</span><span class="err">类描述了一个工作进程池，他有几种不同的方法让任务卸载工作进程。</span>



<span class="err">进程池内部维护一个进程序列，当使用时，则去进程池中获取一个进程，如果进程池序列中没有可供使用的进进程，那么程序就会等待，直到进程池中有可用进程为止。</span>



<span class="err">我们可以用</span><span class="n">Pool</span><span class="err">类创建一个进程池，</span> <span class="err">展开提交的任务给进程池。</span> <span class="err">例：</span>



    <span class="c1">#apply</span>
    <span class="n">from</span><span class="err">  </span><span class="n">multiprocessing</span><span class="err"> </span><span class="n">import</span><span class="err"> </span><span class="n">Pool</span>
    <span class="n">import</span><span class="err"> </span><span class="n">time</span>
    <span class="err"> </span>
    <span class="n">def</span><span class="err"> </span><span class="n">f1</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="err">    </span><span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="err">    </span><span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="err">    </span><span class="k">return</span><span class="err"> </span><span class="n">i</span><span class="err"> </span><span class="o">+</span><span class="err"> </span><span class="mi">100</span>
    <span class="err"> </span>
    <span class="k">if</span><span class="err"> </span><span class="vm">__name__</span><span class="err"> </span><span class="o">==</span><span class="err"> </span><span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="err">    </span><span class="n">pool</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">Pool</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="err">    </span><span class="k">for</span><span class="err"> </span><span class="n">i</span><span class="err"> </span><span class="ow">in</span><span class="err"> </span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">31</span><span class="p">):</span>
    <span class="err">        </span><span class="n">pool</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">f1</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,))</span>
    <span class="err"> </span>
    <span class="c1">#apply_async</span>
    <span class="n">def</span><span class="err"> </span><span class="n">f1</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="err">    </span><span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="err">    </span><span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="err">    </span><span class="k">return</span><span class="err"> </span><span class="n">i</span><span class="err"> </span><span class="o">+</span><span class="err"> </span><span class="mi">100</span>
    <span class="n">def</span><span class="err"> </span><span class="n">f2</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
    <span class="err">    </span><span class="k">print</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
    <span class="err"> </span>
    <span class="k">if</span><span class="err"> </span><span class="vm">__name__</span><span class="err"> </span><span class="o">==</span><span class="err"> </span><span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="err">    </span><span class="n">pool</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">Pool</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="err">    </span><span class="k">for</span><span class="err"> </span><span class="n">i</span><span class="err"> </span><span class="ow">in</span><span class="err"> </span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">31</span><span class="p">):</span>
    <span class="err">        </span><span class="n">pool</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">f1</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,),</span><span class="n">callback</span><span class="o">=</span><span class="n">f2</span><span class="p">)</span>
    <span class="err">    </span><span class="n">pool</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="err">    </span><span class="n">pool</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

<span class="err">一个进程池对象可以控制工作进程池的哪些工作可以被提交，它支持超时和回调的异步结果，有一个类似</span><span class="nb">map</span><span class="err">的实现。</span>



<span class="n">processes</span> <span class="err">：使用的工作进程的数量，如果</span><span class="n">processes</span><span class="err">是</span><span class="bp">None</span><span class="err">那么使用</span> <span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span><span class="err">返回的数量。</span>

<span class="n">initializer</span><span class="err">：</span> <span class="err">如果</span><span class="n">initializer</span><span class="err">是</span><span class="bp">None</span><span class="err">，那么每一个工作进程在开始的时候会调用</span><span class="n">initializer</span><span class="p">(</span><span class="o">*</span><span class="n">initargs</span><span class="p">)</span><span class="err">。</span>

<span class="n">maxtasksperchild</span><span class="err">：工作进程退出之前可以完成的任务数，完成后用一个心的工作进程来替代原进程，来让闲置的资源被释放。</span><span class="n">maxtasksperchi</span>
<span class="n">ld</span><span class="err">默认是</span><span class="bp">None</span><span class="err">，意味着只要</span><span class="n">Pool</span><span class="err">存在工作进程就会一直存活。</span>

<span class="n">context</span><span class="p">:</span> <span class="err">用在制定工作进程启动时的上下文，一般使用</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Pool</span><span class="p">()</span>
<span class="err">或者一个</span><span class="n">context</span><span class="err">对象的</span><span class="n">Pool</span><span class="p">()</span><span class="err">方法来创建一个池，两种方法都适当的设置了</span><span class="n">context</span>

<span class="err">注意：</span><span class="n">Pool</span><span class="err">对象的方法只可以被创建</span><span class="n">pool</span><span class="err">的进程所调用。</span>



<span class="n">New</span> <span class="ow">in</span> <span class="n">version</span> <span class="mf">3.2</span><span class="p">:</span> <span class="n">maxtasksperchild</span>

<span class="n">New</span> <span class="ow">in</span> <span class="n">version</span> <span class="mf">3.4</span><span class="p">:</span> <span class="n">context</span>



<span class="c1">### 进程池的方法</span>

<span class="nb">apply</span><span class="p">(</span><span class="n">func</span><span class="p">[,</span> <span class="n">args</span><span class="p">[,</span> <span class="n">kwds</span><span class="p">]])</span> <span class="err">：使用</span><span class="n">arg</span><span class="err">和</span><span class="n">kwds</span><span class="err">参数调用</span><span class="n">func</span><span class="err">函数，结果返回前会一直阻塞，由于这个原因，</span><span class="n">apply_asyn</span>
<span class="n">c</span><span class="p">()</span><span class="err">更适合并发执行，另外，</span><span class="n">func</span><span class="err">函数仅被</span><span class="n">pool</span><span class="err">中的一个进程运行。</span>



<span class="n">apply_async</span><span class="p">(</span><span class="n">func</span><span class="p">[,</span> <span class="n">args</span><span class="p">[,</span> <span class="n">kwds</span><span class="p">[,</span> <span class="n">callback</span><span class="p">[,</span> <span class="n">error_callback</span><span class="p">]]]])</span> <span class="err">：</span> <span class="nb">apply</span><span class="p">()</span><span class="err">方法的一个</span>
<span class="err">变体，会返回一个结果对象。如果</span><span class="n">callback</span><span class="err">被指定，那么</span><span class="n">callback</span><span class="err">可以接收一个参数然后被调用，当结果准备好回调时会调用</span><span class="n">callback</span><span class="err">，调用失败时，</span>
<span class="err">则用</span><span class="n">error_callback</span><span class="err">替换</span><span class="n">callback</span><span class="err">。</span> <span class="n">Callbacks</span><span class="err">应被立即完成，否则处理结果的线程会被阻塞。</span>



<span class="n">close</span><span class="p">()</span> <span class="err">：</span> <span class="err">阻止更多的任务提交到</span><span class="n">pool</span><span class="err">，待任务完成后，工作进程会退出。</span>



<span class="n">terminate</span><span class="p">()</span> <span class="err">：</span> <span class="err">不管任务是否完成，立即停止工作进程。在对</span><span class="n">pool</span><span class="err">对象进程垃圾回收的时候，会立即调用</span><span class="n">terminate</span><span class="p">()</span><span class="err">。</span>



<span class="n">join</span><span class="p">()</span> <span class="p">:</span> <span class="n">wait</span><span class="err">工作线程的退出，在调用</span><span class="n">join</span><span class="p">()</span><span class="err">前，必须调用</span><span class="n">close</span><span class="p">()</span> <span class="ow">or</span>
<span class="n">terminate</span><span class="p">()</span><span class="err">。这样是因为被终止的进程需要被父进程调用</span><span class="n">wait</span><span class="err">（</span><span class="n">join</span><span class="err">等价与</span><span class="n">wait</span><span class="err">），否则进程会成为僵尸进程。</span>



<span class="nb">map</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">iterable</span><span class="p">[,</span> <span class="n">chunksize</span><span class="p">])</span><span class="err">¶</span>



<span class="n">map_async</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">iterable</span><span class="p">[,</span> <span class="n">chunksize</span><span class="p">[,</span> <span class="n">callback</span><span class="p">[,</span> <span class="n">error_callback</span><span class="p">]]])</span><span class="err">¶</span>



<span class="n">imap</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">iterable</span><span class="p">[,</span> <span class="n">chunksize</span><span class="p">])</span><span class="err">¶</span>



<span class="n">imap_unordered</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">iterable</span><span class="p">[,</span> <span class="n">chunksize</span><span class="p">])</span>



<span class="n">starmap</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">iterable</span><span class="p">[,</span> <span class="n">chunksize</span><span class="p">])</span><span class="err">¶</span>



<span class="n">starmap_async</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">iterable</span><span class="p">[,</span> <span class="n">chunksize</span><span class="p">[,</span> <span class="n">callback</span><span class="p">[,</span> <span class="n">error_back</span><span class="p">]]])</span>



<span class="c1">### python 协程</span>



<span class="err">线程和进程的操作是由程序触发系统接口，最后的执行者是系统；协程的操作则是程序员。</span>



<span class="err">协程存在的意义：对于多线程应用，</span><span class="n">CPU</span><span class="err">通过切片的方式来切换线程间的执行，线程切换时需要耗时（保存状态，下次继续）。协程，则只使用一个线程，在一个线程中规定某</span>
<span class="err">个代码块执行顺序。</span>



<span class="err">协程的适用场景：当程序中存在大量不需要</span><span class="n">CPU</span><span class="err">的操作时（</span><span class="n">IO</span><span class="err">），适用于协程；</span>



<span class="n">event</span> <span class="n">loop</span><span class="err">是协程执行的控制点，</span> <span class="err">如果你希望执行协程，</span> <span class="err">就需要用到它们。</span>



<span class="n">event</span> <span class="n">loop</span><span class="err">提供了如下的特性：</span>



<span class="err">注册、执行、取消延时调用</span><span class="p">(</span><span class="err">异步函数</span><span class="p">)</span>

<span class="err">创建用于通信的</span><span class="n">client</span><span class="err">和</span><span class="n">server</span><span class="err">协议</span><span class="p">(</span><span class="err">工具</span><span class="p">)</span>

<span class="err">创建和别的程序通信的子进程和协议</span><span class="p">(</span><span class="err">工具</span><span class="p">)</span>

<span class="err">把函数调用送入线程池中</span>

<span class="err">协程示例：</span>



    <span class="n">import</span><span class="err"> </span><span class="n">asyncio</span>
    <span class="err">  </span>
    <span class="n">async</span><span class="err"> </span><span class="n">def</span><span class="err"> </span><span class="n">cor1</span><span class="p">():</span>
    <span class="err">    </span><span class="k">print</span><span class="p">(</span><span class="s2">&quot;COR1 start&quot;</span><span class="p">)</span>
    <span class="err">    </span><span class="n">await</span><span class="err"> </span><span class="n">cor2</span><span class="p">()</span>
    <span class="err">    </span><span class="k">print</span><span class="p">(</span><span class="s2">&quot;COR1 end&quot;</span><span class="p">)</span>
    <span class="err">  </span>
    <span class="n">async</span><span class="err"> </span><span class="n">def</span><span class="err"> </span><span class="n">cor2</span><span class="p">():</span>
    <span class="err">    </span><span class="k">print</span><span class="p">(</span><span class="s2">&quot;COR2&quot;</span><span class="p">)</span>
    <span class="err">  </span>
    <span class="n">loop</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
    <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">cor1</span><span class="p">())</span>
    <span class="n">loop</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="err">最后三行是重点。</span>



<span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span> <span class="err"> </span><span class="p">:</span> <span class="n">asyncio</span><span class="err">启动默认的</span><span class="n">event</span> <span class="n">loop</span>

<span class="n">run_until_complete</span><span class="p">()</span> <span class="err"> </span><span class="p">:</span> <span class="err"> 这个函数是阻塞执行的，知道所有的异步函数执行完成，</span>

<span class="n">close</span><span class="p">()</span> <span class="err"> </span><span class="p">:</span> <span class="err"> 关闭</span><span class="n">event</span> <span class="n">loop</span><span class="err">。</span>

<span class="c1">### 1、greenlet</span>



    <span class="n">import</span><span class="err"> </span><span class="n">greenlet</span>
    <span class="n">def</span><span class="err"> </span><span class="n">fun1</span><span class="p">():</span>
    <span class="err">    </span><span class="k">print</span><span class="p">(</span><span class="s2">&quot;12&quot;</span><span class="p">)</span>
    <span class="err">    </span><span class="n">gr2</span><span class="o">.</span><span class="n">switch</span><span class="p">()</span>
    <span class="err">    </span><span class="k">print</span><span class="p">(</span><span class="s2">&quot;56&quot;</span><span class="p">)</span>
    <span class="err">    </span><span class="n">gr2</span><span class="o">.</span><span class="n">switch</span><span class="p">()</span>
    <span class="err"> </span>
    <span class="n">def</span><span class="err"> </span><span class="n">fun2</span><span class="p">():</span>
    <span class="err">    </span><span class="k">print</span><span class="p">(</span><span class="s2">&quot;34&quot;</span><span class="p">)</span>
    <span class="err">    </span><span class="n">gr1</span><span class="o">.</span><span class="n">switch</span><span class="p">()</span>
    <span class="err">    </span><span class="k">print</span><span class="p">(</span><span class="s2">&quot;78&quot;</span><span class="p">)</span>
    <span class="err"> </span>
    <span class="err"> </span>
    <span class="n">gr1</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">greenlet</span><span class="o">.</span><span class="n">greenlet</span><span class="p">(</span><span class="n">fun1</span><span class="p">)</span>
    <span class="n">gr2</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">greenlet</span><span class="o">.</span><span class="n">greenlet</span><span class="p">(</span><span class="n">fun2</span><span class="p">)</span>
    <span class="n">gr1</span><span class="o">.</span><span class="n">switch</span><span class="p">()</span>



<span class="c1">### 2、gevent</span>



<span class="n">gevent</span><span class="err">属于第三方模块需要下载安装包</span>



    <span class="n">pip3</span><span class="err"> </span><span class="n">install</span><span class="err"> </span><span class="o">--</span><span class="n">upgrade</span><span class="err"> </span><span class="n">pip3</span>
    <span class="n">pip3</span><span class="err"> </span><span class="n">install</span><span class="err"> </span><span class="n">gevent</span>





    <span class="n">import</span><span class="err"> </span><span class="n">gevent</span>
    <span class="err"> </span>
    <span class="n">def</span><span class="err"> </span><span class="n">fun1</span><span class="p">():</span>
    <span class="err">    </span><span class="k">print</span><span class="p">(</span><span class="s2">&quot;www.baidu.com&quot;</span><span class="p">)</span><span class="err">   </span><span class="c1"># 第一步</span>
    <span class="err">    </span><span class="n">gevent</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="err">    </span><span class="k">print</span><span class="p">(</span><span class="s2">&quot;end the baidu.com&quot;</span><span class="p">)</span><span class="err">  </span><span class="c1"># 第三步</span>
    <span class="err"> </span>
    <span class="n">def</span><span class="err"> </span><span class="n">fun2</span><span class="p">():</span>
    <span class="err">    </span><span class="k">print</span><span class="p">(</span><span class="s2">&quot;www.zhihu.com&quot;</span><span class="p">)</span><span class="err">   </span><span class="c1"># 第二步</span>
    <span class="err">    </span><span class="n">gevent</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="err">    </span><span class="k">print</span><span class="p">(</span><span class="s2">&quot;end th zhihu.com&quot;</span><span class="p">)</span><span class="err">  </span><span class="c1"># 第四步</span>
    <span class="err"> </span>
    <span class="n">gevent</span><span class="o">.</span><span class="n">joinall</span><span class="p">([</span>
    <span class="err">    </span><span class="n">gevent</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="n">fun1</span><span class="p">),</span>
    <span class="err">    </span><span class="n">gevent</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="n">fun2</span><span class="p">),</span>
    <span class="p">])</span>

<span class="err">遇到</span><span class="n">IO</span><span class="err">操作自动切换：</span>



    <span class="n">import</span><span class="err"> </span><span class="n">gevent</span>
    <span class="n">import</span><span class="err"> </span><span class="n">requests</span>
    <span class="n">def</span><span class="err"> </span><span class="n">func</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="err">    </span><span class="k">print</span><span class="p">(</span><span class="s2">&quot;get: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">url</span><span class="p">)</span>
    <span class="err">    </span><span class="n">gevent</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="err">    </span><span class="n">date</span><span class="err"> </span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="err">    </span><span class="n">ret</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">date</span><span class="o">.</span><span class="n">text</span>
    <span class="err">    </span><span class="k">print</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">ret</span><span class="p">))</span>
    <span class="n">gevent</span><span class="o">.</span><span class="n">joinall</span><span class="p">([</span>
    <span class="err">    </span><span class="n">gevent</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="n">func</span><span class="p">,</span><span class="err"> </span><span class="s1">&#39;https://www.pythontab.com/&#39;</span><span class="p">),</span>
    <span class="err">    </span><span class="n">gevent</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="n">func</span><span class="p">,</span><span class="err"> </span><span class="s1">&#39;https://www.yahoo.com/&#39;</span><span class="p">),</span>
    <span class="err">    </span><span class="n">gevent</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="n">func</span><span class="p">,</span><span class="err"> </span><span class="s1">&#39;https://github.com/&#39;</span><span class="p">),</span>
    <span class="p">])</span>



<span class="err">文章转自：</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">cnblogs</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">aylin</span><span class="o">/</span><span class="n">p</span><span class="o">/</span><span class="mf">5601969.</span><span class="n">html</span>
</pre></div>
                </div><!-- /.entry-content -->
                <!-- 来必力City版安装代码 -->
                <div id="lv-container" data-id="city" data-uid="MTAyMC8zNjgwNi8xMzM0Mg==">
                    <script type="text/javascript">
                   (function(d, s) {
                       var j, e = d.getElementsByTagName(s)[0];

                       if (typeof LivereTower === 'function') { return; }

                       j = d.createElement(s);
                       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
                       j.async = true;

                       e.parentNode.insertBefore(j, e);
                   })(document, 'script');
                    </script>
                <noscript> 为正常使用来必力评论功能请激活JavaScript</noscript>
                </div>
                <!-- City版安装代码已完成 -->
        </article>
</section>
        </div><!--/span-->

                <div class="span3 well sidebar-nav" id="sidebar">
<ul class="nav nav-list">
<li class="nav-header"><h4><i class="icon-external-link"></i>blogroll</h4></li>
    <li><a href="http://getpelican.com/"><i class="icon-external-link"></i>Pelican</a></li>
    <li><a href="http://python.org/"><i class="icon-external-link"></i>Python.org</a></li>
    <li><a href="http://jinja.pocoo.org/"><i class="icon-external-link"></i>Jinja2</a></li>
    <li><a href="http://www.runoob.com/"><i class="icon-external-link"></i>Python教程</a></li>
    <li><a href="https://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000"><i class="icon-external-link"></i>廖雪峰Python</a></li>
<li class="nav-header"><h4><i class="icon-home icon-large"></i> social</h4></li>
<li><a href="/feeds/all.atom.xml" rel="alternate"><i class="icon-bookmark icon-large"></i>atom feed</a></li>
    <li><a href="https://github.com/RuiJee"><i class="icon-Github-sign icon-large"></i>Github</a></li>

<li class="nav-header"><h4> <a href="/categories.html"><i class="icon-folder-close icon-large"></i>Categories</a></h4></li>
<li>
<a href="/category/code-example/index.html">
    <i class="icon-folder-open icon-large"></i>Code Example
</a>
</li>
<li>
<a href="/category/linux/index.html">
    <i class="icon-folder-open icon-large"></i>Linux
</a>
</li>
<li>
<a href="/category/pa-chong-ji-zhu/index.html">
    <i class="icon-folder-open icon-large"></i>爬虫技术
</a>
</li>
<li>
<a href="/category/pythonji-zhu/index.html">
    <i class="icon-folder-open icon-large"></i>Python技术
</a>
</li>

<li class="nav-header"><h4> <a href="/tags.html"><i class="icon-tags icon-large"></i>Tags</a></h4></li>
<li class="tag-4">
    <a href="/tag/centos/index.html">
        <i class="icon-tag icon-large"></i>centos
    </a>
</li>
<li class="tag-3">
    <a href="/tag/pycharm/index.html">
        <i class="icon-tag icon-large"></i>pycharm
    </a>
</li>
<li class="tag-3">
    <a href="/tag/python3/index.html">
        <i class="icon-tag icon-large"></i>python3
    </a>
</li>
<li class="tag-4">
    <a href="/tag/shu/index.html">
        <i class="icon-tag icon-large"></i>书
    </a>
</li>
<li class="tag-4">
    <a href="/tag/str/index.html">
        <i class="icon-tag icon-large"></i>str
    </a>
</li>
<li class="tag-3">
    <a href="/tag/iterator/index.html">
        <i class="icon-tag icon-large"></i>iterator
    </a>
</li>
<li class="tag-4">
    <a href="/tag/ci-yun/index.html">
        <i class="icon-tag icon-large"></i>词云
    </a>
</li>
<li class="tag-2">
    <a href="/tag/pa-chong/index.html">
        <i class="icon-tag icon-large"></i>爬虫
    </a>
</li>
<li class="tag-2">
    <a href="/tag/code_gui/index.html">
        <i class="icon-tag icon-large"></i>code_gui
    </a>
</li>
<li class="tag-4">
    <a href="/tag/tuple/index.html">
        <i class="icon-tag icon-large"></i>tuple
    </a>
</li>
<li class="tag-4">
    <a href="/tag/fudge/index.html">
        <i class="icon-tag icon-large"></i>fudge
    </a>
</li>
<li class="tag-4">
    <a href="/tag/zuo-yong-yu/index.html">
        <i class="icon-tag icon-large"></i>作用域
    </a>
</li>
<li class="tag-3">
    <a href="/tag/list/index.html">
        <i class="icon-tag icon-large"></i>list
    </a>
</li>
<li class="tag-4">
    <a href="/tag/virtualenv/index.html">
        <i class="icon-tag icon-large"></i>virtualenv
    </a>
</li>
<li class="tag-4">
    <a href="/tag/decorator/index.html">
        <i class="icon-tag icon-large"></i>decorator
    </a>
</li>
<li class="tag-1">
    <a href="/tag/code_base/index.html">
        <i class="icon-tag icon-large"></i>code_base
    </a>
</li>
<li class="tag-4">
    <a href="/tag/dian-zi-shu/index.html">
        <i class="icon-tag icon-large"></i>电子书
    </a>
</li>
<li class="tag-4">
    <a href="/tag/zhi-hu/index.html">
        <i class="icon-tag icon-large"></i>知乎
    </a>
</li>
<li class="tag-4">
    <a href="/tag/legb/index.html">
        <i class="icon-tag icon-large"></i>legb
    </a>
</li>
<li class="tag-3">
    <a href="/tag/shi-xian-yuan-li/index.html">
        <i class="icon-tag icon-large"></i>实现原理
    </a>
</li>
<li class="tag-4">
    <a href="/tag/re/index.html">
        <i class="icon-tag icon-large"></i>re
    </a>
</li>
<li class="tag-4">
    <a href="/tag/pip/index.html">
        <i class="icon-tag icon-large"></i>pip
    </a>
</li>
<li class="tag-4">
    <a href="/tag/jie-huo/index.html">
        <i class="icon-tag icon-large"></i>解惑
    </a>
</li>
<li class="tag-4">
    <a href="/tag/datetime/index.html">
        <i class="icon-tag icon-large"></i>datetime
    </a>
</li>
<li class="tag-4">
    <a href="/tag/zheng-ze-biao-da-shi/index.html">
        <i class="icon-tag icon-large"></i>正则表达式
    </a>
</li>
<li class="tag-4">
    <a href="/tag/cai-dan/index.html">
        <i class="icon-tag icon-large"></i>彩蛋
    </a>
</li>
<li class="tag-4">
    <a href="/tag/biao-qian-yun/index.html">
        <i class="icon-tag icon-large"></i>标签云
    </a>
</li>
<li class="tag-4">
    <a href="/tag/lambda/index.html">
        <i class="icon-tag icon-large"></i>lambda
    </a>
</li>
<li class="tag-4">
    <a href="/tag/ru-men/index.html">
        <i class="icon-tag icon-large"></i>入门
    </a>
</li>
<li class="tag-3">
    <a href="/tag/suan-fa/index.html">
        <i class="icon-tag icon-large"></i>算法
    </a>
</li>
<li class="tag-4">
    <a href="/tag/stringio/index.html">
        <i class="icon-tag icon-large"></i>stringio
    </a>
</li>
<li class="tag-4">
    <a href="/tag/rename/index.html">
        <i class="icon-tag icon-large"></i>rename
    </a>
</li>
<li class="tag-4">
    <a href="/tag/luan-ma/index.html">
        <i class="icon-tag icon-large"></i>乱码
    </a>
</li>
<li class="tag-3">
    <a href="/tag/dict/index.html">
        <i class="icon-tag icon-large"></i>dict
    </a>
</li>
<li class="tag-4">
    <a href="/tag/int/index.html">
        <i class="icon-tag icon-large"></i>int
    </a>
</li>
<li class="tag-4">
    <a href="/tag/singleton/index.html">
        <i class="icon-tag icon-large"></i>singleton
    </a>
</li>
<li class="tag-4">
    <a href="/tag/with/index.html">
        <i class="icon-tag icon-large"></i>with
    </a>
</li>
<li class="tag-4">
    <a href="/tag/python27/index.html">
        <i class="icon-tag icon-large"></i>python27
    </a>
</li>
<li class="tag-4">
    <a href="/tag/tornado/index.html">
        <i class="icon-tag icon-large"></i>tornado
    </a>
</li>
<li class="tag-1">
    <a href="/tag/code_demos/index.html">
        <i class="icon-tag icon-large"></i>code_Demos
    </a>
</li>
<li class="tag-3">
    <a href="/tag/han-shu/index.html">
        <i class="icon-tag icon-large"></i>函数
    </a>
</li>
<li class="tag-2">
    <a href="/tag/code_scripts-shell/index.html">
        <i class="icon-tag icon-large"></i>code_scripts-shell
    </a>
</li>
<li class="tag-4">
    <a href="/tag/code_mobile/index.html">
        <i class="icon-tag icon-large"></i>code_mobile
    </a>
</li>
<li class="tag-4">
    <a href="/tag/thread/index.html">
        <i class="icon-tag icon-large"></i>thread
    </a>
</li>
<li class="tag-2">
    <a href="/tag/code_game/index.html">
        <i class="icon-tag icon-large"></i>code_game
    </a>
</li>
<li class="tag-4">
    <a href="/tag/ming-ming-kong-jian/index.html">
        <i class="icon-tag icon-large"></i>命名空间
    </a>
</li>
<li class="tag-2">
    <a href="/tag/code_graphics/index.html">
        <i class="icon-tag icon-large"></i>code_graphics
    </a>
</li>
<li class="tag-4">
    <a href="/tag/beautifulsoup/index.html">
        <i class="icon-tag icon-large"></i>beautifulsoup
    </a>
</li>
<li class="tag-3">
    <a href="/tag/generator/index.html">
        <i class="icon-tag icon-large"></i>generator
    </a>
</li>
<li class="tag-4">
    <a href="/tag/metaclass/index.html">
        <i class="icon-tag icon-large"></i>metaclass
    </a>
</li>
<li class="tag-2">
    <a href="/tag/linux/index.html">
        <i class="icon-tag icon-large"></i>linux
    </a>
</li>
<li class="tag-4">
    <a href="/tag/django/index.html">
        <i class="icon-tag icon-large"></i>django
    </a>
</li>
<li class="tag-2">
    <a href="/tag/bian-ma/index.html">
        <i class="icon-tag icon-large"></i>编码
    </a>
</li>
<li class="tag-4">
    <a href="/tag/yield/index.html">
        <i class="icon-tag icon-large"></i>yield
    </a>
</li>
<li class="tag-1">
    <a href="/tag/code_algorithm/index.html">
        <i class="icon-tag icon-large"></i>code_algorithm
    </a>
</li>
<li class="tag-2">
    <a href="/tag/code_mail/index.html">
        <i class="icon-tag icon-large"></i>code_mail
    </a>
</li>
<li class="tag-2">
    <a href="/tag/code_linux/index.html">
        <i class="icon-tag icon-large"></i>code_linux
    </a>
</li>
<li class="tag-4">
    <a href="/tag/book/index.html">
        <i class="icon-tag icon-large"></i>book
    </a>
</li>
<li class="tag-1">
    <a href="/tag/code_text-file/index.html">
        <i class="icon-tag icon-large"></i>code_text-file
    </a>
</li>
<li class="tag-3">
    <a href="/tag/zhuang-shi-qi/index.html">
        <i class="icon-tag icon-large"></i>装饰器
    </a>
</li>
<li class="tag-4">
    <a href="/tag/extractor/index.html">
        <i class="icon-tag icon-large"></i>extractor
    </a>
</li>
<li class="tag-4">
    <a href="/tag/bi-bao/index.html">
        <i class="icon-tag icon-large"></i>闭包
    </a>
</li>
<li class="tag-4">
    <a href="/tag/intern/index.html">
        <i class="icon-tag icon-large"></i>intern
    </a>
</li>
<li class="tag-3">
    <a href="/tag/pythonic/index.html">
        <i class="icon-tag icon-large"></i>pythonic
    </a>
</li>
<li class="tag-4">
    <a href="/tag/timestamp/index.html">
        <i class="icon-tag icon-large"></i>timestamp
    </a>
</li>
<li class="tag-4">
    <a href="/tag/lsof/index.html">
        <i class="icon-tag icon-large"></i>lsof
    </a>
</li>
<li class="tag-4">
    <a href="/tag/free/index.html">
        <i class="icon-tag icon-large"></i>free
    </a>
</li>
<li class="tag-2">
    <a href="/tag/python/index.html">
        <i class="icon-tag icon-large"></i>python
    </a>
</li>
<li class="tag-4">
    <a href="/tag/gc/index.html">
        <i class="icon-tag icon-large"></i>gc
    </a>
</li>
<li class="tag-4">
    <a href="/tag/equals-identical/index.html">
        <i class="icon-tag icon-large"></i>equals-identical
    </a>
</li>
<li class="tag-2">
    <a href="/tag/code_security/index.html">
        <i class="icon-tag icon-large"></i>code_security
    </a>
</li>
<li class="tag-4">
    <a href="/tag/iterable/index.html">
        <i class="icon-tag icon-large"></i>iterable
    </a>
</li>
<li class="tag-3">
    <a href="/tag/requests/index.html">
        <i class="icon-tag icon-large"></i>requests
    </a>
</li>
<li class="tag-3">
    <a href="/tag/http/index.html">
        <i class="icon-tag icon-large"></i>http
    </a>
</li>
<li class="tag-1">
    <a href="/tag/code_other/index.html">
        <i class="icon-tag icon-large"></i>code_other
    </a>
</li>
<li class="tag-4">
    <a href="/tag/method/index.html">
        <i class="icon-tag icon-large"></i>method
    </a>
</li>
<li class="tag-4">
    <a href="/tag/djang-blog/index.html">
        <i class="icon-tag icon-large"></i>djang-blog
    </a>
</li>
<li class="tag-4">
    <a href="/tag/for/index.html">
        <i class="icon-tag icon-large"></i>for
    </a>
</li>


</ul>        </div><!--/.well -->

      </div><!--/row-->

      <hr>

      <footer>
        <!--<address id="about">
                Proudly powered by <a href="http://pelican.notmyidea.org/">Pelican <i class="icon-external-link"></i></a>,
                                which takes great advantage of <a href="http://python.org">Python <i class="icon-external-link"></i></a>.
        </address>--><!-- /#about -->

       <!-- <p>The theme is from <a href="http://twitter.github.com/bootstrap/">Bootstrap from Twitter <i class="icon-external-link"></i></a>,
                   and <a href="http://fortawesome.github.com/Font-Awesome/">Font-Awesome <i class="icon-external-link"></i></a>, thanks!</p>-->
         <p>&copy; Alex 2018</p>
      </footer>

    </div><!--/.fluid-container-->



    <!-- Le javascript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!--<script src="/theme/js/jquery-1.7.2.min.js"></script>-->
    <script src="/theme/js/bootstrap.min.js"></script>
  </body>
</html>